(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{145:function(e,t,n){},146:function(e,t,n){},147:function(e,t,n){},148:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(59),i=n.n(o),s=n(22),c=n(6),l=(n(69),n(10)),u=n(11),h=n(15),d=n(14),p=(n(70),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"Footer"},"Copyright \xa9 2020 Melle Sieswerda. All rights reserved.")}}]),n}(r.Component)),f=(n(71),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).onChange=function(t){var n=t.target.value;e.props.onNetworkSelected(n)},e}return Object(u.a)(n,[{key:"renderOptions",value:function(){return this.props.networks.map((function(e){return a.a.createElement("option",{key:e.id,value:e.id},e.name)}))}},{key:"render",value:function(){var e=this.props.network_id;return a.a.createElement("div",{className:"Header"},a.a.createElement("div",{className:"top"},a.a.createElement("div",{className:"left"},a.a.createElement("span",{className:"h1"},a.a.createElement(s.b,{to:"/",className:"main"},"Thomas")),"\xa0 A Bayesian Network viewer."),a.a.createElement("div",{className:"right"},a.a.createElement("a",{href:"https://github.com/mellesies/thomas-master",target:"_blank",rel:"noopener noreferrer"},"Github"))),a.a.createElement("select",{onChange:this.onChange,value:e||""},a.a.createElement("option",{disabled:!0,value:""}," -- select Bayesian network -- "),this.renderOptions()))}}]),n}(r.Component)),m=n(63),v=n(35),g=n(17),k=n(9),y=n(61),w=n.n(y),b=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var r;Object(l.a)(this,n),(r=t.call(this,e)).onDragMove=function(e){var t=e.target.x(),n=e.target.y();r.setPosition(t,n),r.props.onDragMove&&r.props.onDragMove(r.RV,t,n)},r.onDragEnd=function(e){var t=e.target.x(),n=e.target.y();r.props.onDragEnd&&r.props.onDragEnd(r.RV,t,n)},r.onStateToggled=function(e){r.props.onStateToggled&&r.props.onStateToggled(r.RV,e)},r.RV=e.node.RV,r.titleHeight=15,r.stateOffset=8,r.stateHeight=14,r.statePadding=2,r.width=180,r.height=r.computeHeight();var a=e.node.position[0],o=e.node.position[1];return r.setPosition(a,o),r}return Object(u.a)(n,[{key:"createStates",value:function(e,t,n){var r=this,o=this.width,i=o-70-55;return e.states.map((function(e,s){var c=r.titleHeight+r.stateOffset+s*r.stateHeight,l="...",u=0,h="#003366";return n&&n===e&&(h="#00BCCC"),t&&(l=(100*t[e]).toFixed(2)+"%",u=1+i*t[e]),a.a.createElement(k.Group,{key:e,y:c},a.a.createElement(k.Label,null,a.a.createElement(k.Tag,null),a.a.createElement(k.Text,{text:e,padding:r.statePadding,fontSize:r.stateHeight-r.statePadding,wrap:"none",ellipsis:"ellipsis",width:70})),a.a.createElement(k.Rect,{x:70,y:1,width:u,height:r.stateHeight-2,fill:h}),a.a.createElement(k.Label,{x:o-55},a.a.createElement(k.Tag,null),a.a.createElement(k.Text,{text:l,padding:r.statePadding,fontSize:r.stateHeight-r.statePadding,align:"right",wrap:"none",width:55})))}))}},{key:"computeHeight",value:function(){return this.props.node.states.length*this.stateHeight+2*this.stateOffset+this.titleHeight}},{key:"setPosition",value:function(e,t){var n=this.width,r=this.height;this.x=e,this.y=t,this.center={x:e+n/2,y:t+r/2},this.corners={tl:{x:e,y:t},tr:{x:e+n,y:t},bl:{x:e,y:t+r},br:{x:e+n,y:t+r}}}},{key:"render",value:function(){var e=this.props,t=e.node,n=e.query,r=e.probabilities,o=this.x,i=this.y,s=this.width,c=this.height,l=this.createStates(t,r,n);return a.a.createElement(k.Group,{x:o,y:i,width:s,height:c,onDragMove:this.onDragMove,onDragEnd:this.onDragEnd,draggable:!0},a.a.createElement(k.Rect,{fill:"#efefef",width:s,height:c,cornerRadius:5,shadowBlur:5}),a.a.createElement(k.Label,null,a.a.createElement(k.Tag,null),a.a.createElement(k.Text,{text:t.name,padding:4,fontSize:this.titleHeight,fontStyle:"bold",width:s})),l)}}]),n}(r.Component),E=n(25),O=n(32),_=n.n(O),j=n(62),x=n.n(j),N=new(function(){function e(){Object(l.a)(this,e),this._axios=null,this._user=!1}return Object(u.a)(e,[{key:"init",value:function(e){var t=this,n=new URLSearchParams(window.location.search).get("session_token");this._config=Object(g.a)({withCredentials:!0},e),this._axios=_.a.create(e),this._axios.interceptors.request.use((function(e){return e.params=Object(g.a)({session_token:n},e.params),e})),x()(this._axios,(function(e){return t.refreshAuthLogic(e)})),this.request=this._axios.request}},{key:"_request",value:function(e){return console.log("Api::request()",e),this._axios.request(e).then((function(e){return e.data}))}},{key:"getVersion",value:function(){return this._request({url:"/version",method:"GET"})}},{key:"getSession",value:function(){return this._request({url:"/session",method:"GET",withCredentials:!0})}},{key:"getNetworks",value:function(){return console.log("Api::getNetworks()"),this._request({url:"/network",method:"GET"})}},{key:"getNetwork",value:function(e){return this._request({url:"/network/".concat(e),method:"GET"})}},{key:"saveNetwork",value:function(e,t){return this._request({url:"/network/".concat(e),method:"POST",data:t})}},{key:"queryNetwork",value:function(e,t){var n={id:e,query:Object(g.a)({},t)};return this._request({url:"network/_query",data:n,method:"POST"})}}]),e}());n(145);function S(e){var t=e.src,n=e.dst;return a.a.createElement(k.Arrow,{x:0,y:0,points:[t.x,t.y,n.x,n.y],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:2})}function q(e){return e.nodes.map((function(e){return e.RV}))}function T(e,t,n,r,a,o,i,s){if(e===n&&t===r||a===i&&o===s)return console.warn("Found line of length 0"),!1;var c=(s-o)*(n-e)-(i-a)*(r-t);if(0===c)return console.warn("Denominator is zero 0"),!1;var l=((i-a)*(t-o)-(s-o)*(e-a))/c,u=((n-e)*(t-o)-(r-t)*(e-a))/c;return!(l<0||l>1||u<0||u>1)&&{x:e+l*(n-e),y:t+l*(r-t)}}function R(e,t){for(var n=!1,r=0,a=[["tl","tr"],["tl","bl"],["tr","br"],["bl","br"]];r<a.length;r++){var o=a[r],i=o[0],s=o[1];if(n=T(e[i].x,e[i].y,e[s].x,e[s].y,t.src.x,t.src.y,t.dst.x,t.dst.y))break}return n||console.warn("Could not determine intersection"),n}var C=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).onNodeMove=function(e,t,n){r.nodeAttrsToState()},r.onNodeMoved=function(e,t,n){var a,o=Object(g.a)({},r.state.network),i=r.props.network_id,s=Object(v.a)(o.nodes);try{for(s.s();!(a=s.n()).done;){var c=a.value;if(c.RV===e){c.position=[t,n];break}}}catch(l){s.e(l)}finally{s.f()}N.saveNetwork(i,o)},r.onStateToggled=function(e,t){var n=Object(g.a)({},r.state.query);n[e]&&n[e]===t?delete n[e]:n[e]=t,r.props.history.push({pathname:"",search:"?"+new URLSearchParams(Object(g.a)({},n)).toString()})},r.state={network:null,first_pass_complete:!1,node_centers:{},node_corners:{},query:{},probabilities:{}},r.myRefs={},r}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.setNetwork()}},{key:"componentDidUpdate",value:function(){var e=this.state,t=e.network,n=e.first_pass_complete;t&&!n&&(this.nodeAttrsToState(),this.updateFromQueryParameters())}},{key:"updateFromQueryParameters",value:function(){for(var e,t,n=w.a.parse(this.props.location.search,{ignoreQueryPrefix:!0}),r=this.state.network,a=(e=r.nodes,t="RV",e.reduce((function(e,n){return Object(g.a)(Object(g.a)({},e),{},Object(E.a)({},n[t],n))}),{})),o={},i=0,s=Object.entries(a);i<s.length;i++){var c=Object(m.a)(s[i],2),l=c[0],u=c[1];n[l]&&u.states.includes(n[l])&&(o[l]=n[l])}this.query(o)}},{key:"setNetwork",value:function(){var e=this,t=this.props.network_id;console.log(this.props),N.getNetwork(t).then((function(n){var r=n.json;r.id=t,console.log(t),e.setState({network:r})}))}},{key:"query",value:function(e){var t=this;console.log("Network::query()",e);var n=this.state.network.id;N.queryNetwork(n,e).then((function(e){t.setState({query:e.query,probabilities:e.probabilities})}))}},{key:"nodeAttrsToState",value:function(){var e,t=q(this.state.network),n={},r={},a=Object(v.a)(t);try{for(a.s();!(e=a.n()).done;){var o=e.value,i=this.myRefs[o].current;n[o]=i.center,r[o]=i.corners}}catch(s){a.e(s)}finally{a.f()}this.setState({first_pass_complete:!0,node_centers:n,node_corners:r})}},{key:"computeEdge",value:function(e,t){var n=this.state,r=n.node_centers,a=n.node_corners,o=r[e],i=r[t],s=a[e],c=a[t];return{src:R(s,{src:o,dst:i}),dst:R(c,{src:o,dst:i})}}},{key:"renderEdges",value:function(){var e=this;return this.state.network.edges.map((function(t){var n=t[0],r=t[1],o=e.computeEdge(n,r),i=o.src,s=o.dst;return a.a.createElement(S,{key:"".concat(n,"_").concat(r),src:i,dst:s})}))}},{key:"renderLoading",value:function(){return a.a.createElement("div",{className:"Network"},a.a.createElement("span",null,"Loading ..."))}},{key:"render",value:function(){var e=this,t=this.state.network;if(!t)return this.renderLoading();var n=this.state,r=n.first_pass_complete,o=n.query,i=n.probabilities,s=this.myRefs,c=q(t),l=t.nodes.reduce((function(e,t){return e[t.RV]=t,e}),{});return a.a.createElement("div",{className:"Network"},a.a.createElement("div",{className:"KonvaContainer"},a.a.createElement(k.Stage,{width:2042,height:1024},a.a.createElement(k.Layer,null,r&&this.renderEdges(),c.map((function(t){return s[t]=a.a.createRef(),a.a.createElement(b,{ref:s[t],key:t,node:l[t],query:o[t],probabilities:i[t],onDragMove:e.onNodeMove,onDragEnd:e.onNodeMoved,onStateToggled:e.onStateToggled})}))))))}}]),n}(r.Component),P=(n(146),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).state={networks:[{resourceType:"Network",_id:"/network/rectalcancer",_links:{_self:"/network/rectalcancer",_collection:"/network",owner:"/user/1"},_excluded:["json"],id:"rectalcancer",name:"Rectal cancer"}]},r}return Object(u.a)(n,[{key:"render",value:function(){var e=this.state.networks;return a.a.createElement("div",{className:"Main"},a.a.createElement(f,Object.assign({networks:e,network_id:"rectalcancer",onNetworkSelected:this.onNetworkSelected},this.props)),a.a.createElement(C,Object.assign({key:"/network/rectalcancer",network_id:"rectalcancer"},this.props)))}}]),n}(r.Component)),D=(n(147),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"App"},a.a.createElement(c.c,null,a.a.createElement(c.a,{path:"",component:P})),a.a.createElement(p,null))}}]),n}(r.Component)),H={},L=new URLSearchParams(window.location.search),M=L.get("invocation_host"),A=L.get("invocation_port");H.baseURL="".concat(M,":").concat(A);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));N.init(H),i.a.render(a.a.createElement(s.a,{basename:"/app"},a.a.createElement(c.c,null,a.a.createElement(c.a,{path:"/",component:D}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},64:function(e,t,n){e.exports=n(148)},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){}},[[64,1,2]]]);
//# sourceMappingURL=main.8ad95566.chunk.js.map